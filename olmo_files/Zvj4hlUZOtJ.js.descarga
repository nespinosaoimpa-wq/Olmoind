;/*FB_PKG_DELIM*/

__d("PasskeyAuthenticationUtils",["CaaPasskeyFbFalcoEvent","CometWebAuthn.shared","QPLUserFlow","asyncToGeneratorRuntime","getPasskeyCredentials","promiseDone","qpl"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n,a;if(e!=null){var i=o("CometWebAuthn.shared").string2buffer(e.challenge),l=o("CometWebAuthn.shared").encodeCredentials(e.allow_credentials),s={mediation:"conditional",publicKey:{allowCredentials:l,challenge:i,rpId:e.rp.id,userVerification:e.user_verification}},u=window.PublicKeyCredential,c=(n=yield u==null||u.isConditionalMediationAvailable==null?void 0:u.isConditionalMediationAvailable())!=null?n:!1,d=yield u==null?void 0:u.getClientCapabilities(),m=(a=d==null?void 0:d.relatedOrigins)!=null?a:!1;if(!c||!m){r("CaaPasskeyFbFalcoEvent").logImmediately(function(){return{core:{event:"passkey_login_not_supported",event_category:"login_web",event_flow:"assertion",event_step:"",extra_client_data:{isRelatedOriginSupported:m.toString(),rpId:e.rp.id,supportsConditionalMediation:c.toString(),uri:window.location.href}}}});return}r("CaaPasskeyFbFalcoEvent").logImmediately(function(){return{core:{event:"passkey_login_assertion_triggered",event_category:"login_web",event_flow:"assertion",event_step:"",extra_client_data:{isRelatedOriginSupported:m.toString(),rpId:e.rp.id,supportsConditionalMediation:c.toString(),uri:window.location.href}}}}),r("QPLUserFlow").start(r("qpl")._(175125627,"2233"),{annotations:{string:{entrypoint:"login_web",reason:"FLOW_STARTED",rpId:e.rp.id,uri:window.location.href}}});var p=o("getPasskeyCredentials").getPasskeyCredentials();p.get(s).then(function(n){var a,i={id:n.id,raw_id:(a=o("CometWebAuthn.shared")).bufferEncode(n.rawId),response:{authenticatorData:a.bufferEncode(n.response.authenticatorData),clientDataJSON:a.bufferEncode(n.response.clientDataJSON),signature:a.bufferEncode(n.response.signature),userHandle:a.bufferEncode(n.response.userHandle)},type:n.type},l=a.base64UrlEncode(JSON.stringify(i));r("QPLUserFlow").addPoint(r("qpl")._(175125627,"2233"),"PASSKEY_OS_LOGIN_ASSERTION_SUCCESS"),r("CaaPasskeyFbFalcoEvent").logImmediately(function(){return{core:{event:"passkey_login_assertion_payload_sent_to_server",event_category:"login_web",event_flow:"assertion",event_step:"",extra_client_data:{isRelatedOriginSupported:m.toString(),rpId:e.rp.id,supportsConditionalMediation:c.toString(),uri:window.location.href}}}}),r("promiseDone")(t(l),function(){r("QPLUserFlow").endSuccess(r("qpl")._(175125627,"2233")),r("CaaPasskeyFbFalcoEvent").logImmediately(function(){return{core:{event:"passkey_login_server_success",event_category:"login_web",event_flow:"assertion",event_step:"",extra_client_data:{isRelatedOriginSupported:m.toString(),rpId:e.rp.id,supportsConditionalMediation:c.toString(),uri:window.location.href}}}})},function(t){r("QPLUserFlow").endFailure(r("qpl")._(175125627,"2233"),"PASSKEY_LOGIN_ERROR_FROM_SERVER",{debugInfo:t.message,error:t}),r("CaaPasskeyFbFalcoEvent").logImmediately(function(){return{core:{event:"passkey_login_assertion_failure",event_category:"login_web",event_flow:"assertion",event_step:"",exception_code:t.code,exception_message:t.message,extra_client_data:{isRelatedOriginSupported:m.toString(),rpId:e.rp.id,supportsConditionalMediation:c.toString(),uri:window.location.href}}}})})}).catch(function(t){r("QPLUserFlow").endFailure(r("qpl")._(175125627,"2233"),"PASSKEY_LOGIN_CALL_TO_SERVER_FAILED",{debugInfo:t.message,error:t}),r("CaaPasskeyFbFalcoEvent").logImmediately(function(){return{core:{event:"passkey_login_call_to_server_failed",event_category:"login_web",event_flow:"assertion",event_step:"",exception_code:t.code,exception_message:t.message,extra_client_data:{isRelatedOriginSupported:m.toString(),rpId:e.rp.id,supportsConditionalMediation:c.toString(),uri:window.location.href}}}})})}}),s.apply(this,arguments)}l.initiatePasskeyAuthentication=e}),98);